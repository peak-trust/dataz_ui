// Enhanced transactions table section with sorting and pagination
const allTransactions = MOCK_PROJECTS.filter(p => p.transactions)
    .flatMap(project => 
        project.transactions!.map(transaction => ({
            ...transaction,
            projectName: project.name,
            location: project.location,
            status: project.status
        }))
    )

// Apply sorting
const sortedTransactions = [...allTransactions].sort((a, b) => {
    if (sortColumn === 'date') {
        const comparison = new Date(a.date).getTime() - new Date(b.date).getTime()
        return sortDirection === 'asc' ? comparison : -comparison
    } else if (sortColumn === 'type') {
        const comparison = a.type.localeCompare(b.type)
        return sortDirection === 'asc' ? comparison : -comparison
    } else if (sortColumn === 'price') {
        const comparison = a.price - b.price
        return sortDirection === 'asc' ? comparison : -comparison
    }
    return new Date(b.date).getTime() - new Date(a.date).getTime()
})

// Apply pagination
const totalPages = Math.ceil(sortedTransactions.length / itemsPerPage)
const startIndex = (currentPage - 1) * itemsPerPage
const paginatedTransactions = sortedTransactions.slice(startIndex, startIndex + itemsPerPage)

return (
    <div className="rounded-xl border border-border/50 bg-card shadow-lg overflow-hidden">
        <Table>
            <TableHeader>
                <TableRow className="border-b border-border bg-muted/50">
                    <TableHead 
                        className="h-14 text-xs font-semibold text-foreground uppercase tracking-wider cursor-pointer hover:bg-muted/70 transition-colors"
                        onClick={() => {
                            if (sortColumn === 'date') {
                                setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')
                           } else {
                                setSortColumn('date')
                                setSortDirection('desc')
                            }
                        }}
                    >
                        <div className="flex items-center gap-2">
                            Date
                            {sortColumn === 'date' ? (
                                sortDirection === 'asc' ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />
                            ) : (
                                <ChevronsUpDown className="w-4 h-4 opacity-50" />
                            )}
                        </div>
                    </TableHead>
                    <TableHead 
                        className="h-14 text-xs font-semibold text-foreground uppercase tracking-wider cursor-pointer hover:bg-muted/70 transition-colors"
                        onClick={() => {
                            if (sortColumn === 'type') {
                                setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')
                            } else {
                                setSortColumn('type')
                                setSortDirection('asc')
                            }
                        }}
                    >
                        <div className="flex items-center gap-2">
                            Unit Type
                            {sortColumn === 'type' ? (
                                sortDirection === 'asc' ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />
                            ) : (
                                <ChevronsUpDown className="w-4 h-4 opacity-50" />
                            )}
                        </div>
                    </TableHead>
                    <TableHead 
                        className="h-14 text-xs font-semibold text-foreground uppercase tracking-wider text-right cursor-pointer hover:bg-muted/70 transition-colors"
                        onClick={() => {
                            if (sortColumn === 'price') {
                                setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')
                            } else {
                                setSortColumn('price')
                                setSortDirection('desc')
                            }
                        }}
                    >
                        <div className="flex items-center justify-end gap-2">
                            Price
                            {sortColumn === 'price' ? (
                                sortDirection === 'asc' ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />
                            ) : (
                                <ChevronsUpDown className="w-4 h-4 opacity-50" />
                            )}
                        </div>
                    </TableHead>
                </TableRow>
            </TableHeader>
            <TableBody>
                {paginatedTransactions.map((transaction, idx) => (
                    <TableRow 
                        key={`${transaction.projectName}-${transaction.unit}`}
                        className={`border-b border-border/40 hover:bg-muted/40 transition-colors ${
                            idx % 2 === 0 ? 'bg-background' : 'bg-muted/20'
                        }`}
                    >
                        <TableCell className="py-5 text-sm font-medium text-foreground">
                            {new Date(transaction.date).toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                year: 'numeric'
                            })}
                        </TableCell>
                        <TableCell className="py-5">
                            <div className="flex flex-col gap-1.5">
                                <div className="flex items-center gap-2">
                                    <span className="inline-flex items-center px-2.5 py-1 rounded-md bg-primary/10 border border-primary/20 text-primary text-xs font-bold">
                                        {transaction.type}
                                    </span>
                                    <span className="text-xs text-muted-foreground">
                                        {transaction.size.toLocaleString()} sqft
                                    </span>
                                </div>
                                <span className="text-xs text-muted-foreground">
                                    Unit {transaction.unit}
                                </span>
                            </div>
                        </TableCell>
                        <TableCell className="py-5 text-right">
                            <div className="flex flex-col items-end gap-0.5">
                                <span className="text-base font-bold text-foreground tabular-nums">
                                    AED {transaction.price.toLocaleString()}
                                </span>
                                <span className="text-xs text-muted-foreground tabular-nums">
                                    {Math.round(transaction.price / transaction.size).toLocaleString()} /sqft
                                </span>
                            </div>
                        </TableCell>
                    </TableRow>
                ))}
            </TableBody>
        </Table>
        
        {/* Pagination */}
        {totalPages > 1 && (
            <div className="flex items-center justify-between px-6 py-4 border-t border-border/50 bg-muted/30">
                <div className="text-sm text-muted-foreground">
                    Page {currentPage} of {totalPages}
                </div>
                <div className="flex items-center gap-2">
                    <button
                        onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                        disabled={currentPage === 1}
                        className="px-3 py-1.5 text-sm font-medium rounded-md border border-border bg-background hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    >
                        Previous
                    </button>
                    <div className="flex items-center gap-1">
                        {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (
                            <button
                                key={page}
                                onClick={() => setCurrentPage(page)}
                                className={`w-8 h-8 text-sm font-medium rounded-md transition-colors ${
                                    currentPage === page
                                        ? 'bg-primary text-primary-foreground'
                                        : 'hover:bg-muted'
                                }`}
                            >
                                {page}
                            </button>
                        ))}
                    </div>
                    <button
                        onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}
                        disabled={currentPage === totalPages}
                        className="px-3 py-1.5 text-sm font-medium rounded-md border border-border bg-background hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    >
                        Next
                    </button>
                </div>
            </div>
        )}
    </div>
)
